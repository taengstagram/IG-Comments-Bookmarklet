'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};(function(){function c(z){var A='; '+document.cookie,B=A.split('; '+z+'=');if(2==B.length)return B.pop().split(';').shift()}function d(z,A){return'query_id=17852405266163336&first=1000&shortcode='+encodeURIComponent(z)+'&after='+encodeURIComponent(A)}function e(z){return'undefined'==typeof moment||'undefined'==typeof moment.tz?new Date(1e3*z):moment.tz(1e3*z,'Asia/Seoul').format('YYYY-MM-DD h:mm:ssA z')}function f(z){if(0!=z.length){z.sort(function(F,G){return F.node.created_at>G.node.created_at?1:F.node.created_at<G.node.created_at?-1:0});var _A=t.parentNode.getElementsByTagName('ul')[0],_B=_A.childNodes[0],_C=_A.childNodes[1],_D=_B.className,_E=_A.childNodes[2].getElementsByTagName('a')[0].className;_A.innerHTML='',0<_C.getElementsByTagName('button').length&&(_B.getElementsByTagName('span')[0].getElementsByTagName('span')[0].innerHTML=h(o),_A.appendChild(_B),_A.appendChild(document.createElement('hr')));for(var F=0;F<z.length;F++){var G=z[F].node,H=document.createElement('li');H.classList.add(_D),z[F].fromMention&&H.classList.add('mentioned'),H.innerHTML='<a class="'+_E+'" href="/'+G.owner.username+'/">'+G.owner.username,H.innerHTML+='</a> <span>'+h(G.text)+'</span><span data-comment-id="'+G.id+'" class="dt">'+e(G.created_at)+'</span>',_A.appendChild(H),F==z.length-1&&H.insertAdjacentHTML('afterend','<span class="fn"><a href="'+k+'">//source</a></span>')}}}function g(z){var A=document.getElementsByTagName('article')[0].childNodes[2].childNodes[3];A.innerHTML='<span class="st">'+z+'</span>'}function h(z){return'undefined'==typeof twemoji?z:twemoji.parse(z)}function j(z,A){g('Loading... '+x+'/'+p);var B=new XMLHttpRequest,C=d(z,A);B.open('GET','https://www.instagram.com/graphql/query/?'+C,!0),B.setRequestHeader('x-csrftoken',c('csrftoken')),B.onreadystatechange=function(){if(4==B.readyState)try{var D=JSON.parse(B.responseText);g('Processing... '+x+'/'+p);var E=D.data.shortcode_media.edge_media_to_comment.edges;E.sort(function(F,G){return F.node.created_at>G.node.created_at?-1:F.node.created_at<G.node.created_at?1:0});for(var _F=0;_F<E.length;_F++)if(0<=r.indexOf(E[_F].node.owner.id)){u.push(E[_F]);var G=null;do G=w.exec(E[_F].node.text),G&&0>v.indexOf(G[1])&&v.push(G[1]);while(G)}else{var _G=v.indexOf(E[_F].node.owner.username);if(0<=_G){var H=E[_F];H.fromMention=!0,u.push(H),v.splice(_G,1)}}if(D.data.shortcode_media.edge_media_to_comment.page_info.has_next_page){var _ret=function(){var F=D.data.shortcode_media.edge_media_to_comment.page_info.end_cursor;return 50>=p?j(z,F):setTimeout(function(){j(z,F)},2e3),{v:void 0}}();if('object'==('undefined'==typeof _ret?'undefined':_typeof(_ret)))return _ret.v}g('Done. '+u.length+' comment(s) found.'),f(u)}catch(D){var _E2=' '+u.length+' comment(s) found.';500<=B.status?g('Instagram Error: "'+B.responseText+'"'+_E2):429==B.status?g('Too Many Requests: Please try again later.'+_E2):g('Unexpected error: '+D+_E2),f(u)}},x++,B.send(C)}var k='https://github.com/taengstagram/IG-Comments-Bookmarklet/';console.info('V.20170617.090454'),console.info(k);var l=/https?:\/\/www\.instagram\.com\/p\/([^\/]+)/i,m=l.exec(document.location.href);if(!m)return void console.error('Unable to process page');var n=m[1],o=null,p=0,r=['329452045','1678311178','453462996','363567749','1497851591','416573427','1078607901','2213235565','1499879597'],s=function(A){var B=(document.location.hash||document.location.search).replace('#','&').replace('?','&'),C=B.split('&'+A+'=');if(2==C.length)return C.pop().split('&').shift()}('wanted');s&&(r=r.concat(s.split(',')));var t=document.getElementsByTagName('section')[1],u=[],v=[],w=/@([a-z0-9_]+([\.][a-z0-9]+)?)/ig,x=1;if('undefined'==typeof twemoji||'undefined'==typeof moment||'undefined'==typeof moment.tz){var z=document.getElementsByTagName('head')[0],A=['https://twemoji.maxcdn.com/2/twemoji.min.js?2.2.5','https://unpkg.com/moment/min/moment.min.js','https://unpkg.com/moment-timezone/builds/moment-timezone-with-data.min.js'];for(var C=0;C<A.length;C++){var D=document.createElement('script');D.src=A[C],D.async=!1,z.appendChild(D)}var B=document.createElement('style');B.innerHTML='img.emoji { height: 1em; width: 1em; margin: 0 .05em 0 .1em; vertical-align: -0.1em; } span.dt { color: #888; font-size: small; display: block; } .st { color: #1565c0; } .fn a { color: #1565c0; font-size: x-small; }.mentioned { opacity: 0.75; }.verified { flex-shrink: 0; margin-left: 2px; display: inline-block; overflow: hidden; text-indent: 110%; white-space: nowrap; }',z.appendChild(B)}var y=new XMLHttpRequest;g('Loading...'),y.open('GET','https://www.instagram.com/p/'+n+'/?__a=1',!0),y.onreadystatechange=function(){if(4==y.readyState){var _z=JSON.parse(y.responseText).graphql;if(0>r.indexOf(_z.shortcode_media.owner.id)&&r.push(_z.shortcode_media.owner.id),_z.shortcode_media.edge_media_to_caption.edges.length){o=_z.shortcode_media.edge_media_to_caption.edges[0].node.text;var _A2=null;do _A2=w.exec(o),_A2&&0>v.indexOf(_A2[1])&&v.push(_A2[1]);while(_A2)}if(0<_z.shortcode_media.edge_media_to_tagged_user.edges.length)for(var _A3=0;_A3<_z.shortcode_media.edge_media_to_tagged_user.edges.length;_A3++){var _B2=_z.shortcode_media.edge_media_to_tagged_user.edges[_A3].node.user.username;0>v.indexOf(_B2)&&v.push(_B2)}p=Math.ceil(_z.shortcode_media.edge_media_to_comment.count/1e3),j(_z.shortcode_media.shortcode,'')}},y.send()})();
